"use strict";(self["webpackChunkwork_qianfeng"]=self["webpackChunkwork_qianfeng"]||[]).push([[911],{5911:function(t,s,e){e.r(s),e.d(s,{default:function(){return d}});var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"cart-box"},[t._l(t.productsList,(function(s){return e("van-card",{attrs:{num:s.count,price:(s.price/100).toFixed(2),desc:s.descriptions,title:s.name,thumb:s.coverImg},scopedSlots:t._u([{key:"footer",fn:function(){return[e("van-button",{attrs:{size:"mini"},on:{click:function(e){return t.add(s)}}},[t._v("增加")]),e("van-button",{attrs:{size:"mini"},on:{click:function(e){return t.reduce(s)}}},[t._v("减少")])]},proxy:!0}],null,!0)})})),e("van-submit-bar",{staticStyle:{bottom:"50px"},attrs:{price:t.sumPrice,"button-text":"提交订单"},on:{submit:t.onSubmitOrder}})],2)},r=[],o=e(525),n={name:"Cart",data(){return{productsList:[],proId:1,cartList:JSON.parse(localStorage.getItem("cartProductsList")||"[]")}},computed:{sumPrice(){let t=0;return 0!==this.productsList.length&&this.productsList.forEach((s=>{t+=s.price*s.count})),t}},watch:{productsList:{deep:!0,handler(){const t=[];this.productsList.forEach((s=>{t.push({id:s._id,count:s.count})})),this.cartList=t,localStorage.setItem("cartProductsList",JSON.stringify(this.cartList))}}},mounted(){0===this.cartList.length&&this.$toast("您的购物车空空如也！")},created(){const t=[];this.cartList.forEach((s=>{t.push(new Promise(((t,e)=>{(0,o.FO)(s.id).then((s=>{t(s)})).catch((t=>{e(t)}))})))})),Promise.all(t).then((t=>{t.forEach(((t,s)=>{t.id=this.proId++,t.count=this.cartList[s].count})),this.productsList=t})).catch((t=>{console.log(t)}))},methods:{add(t){t.count++,t.count>t.quantity&&(this.$toast.fail("已经是最大数量"),t.count--)},reduce(t){t.count--,t.count<=0&&this.$dialog.confirm({title:"确认移出购物车吗？",message:`将商品 ${t.name} 移出购物车`}).then((()=>{this.productsList=this.productsList.filter((s=>s.id!==t.id&&s.name!==t.name))})).catch((()=>{t.count++}))},onSubmitOrder(){0!==this.productsList.length?this.$dialog.confirm({title:"确认提交订单吗",message:`共需支付${(this.sumPrice/100).toFixed(2)}元`}).then((()=>{this.productsList=[],this.$dialog.alert({message:"支付成功，购物车已被清空",theme:"round-button"})})).catch((()=>{this.$dialog.alert({message:"取消支付成功",theme:"round-button"})})):this.$dialog.alert({message:"购物车已空，无需提交订单，速去选购吧",theme:"round-button"})}}},c=n,a=e(1001),u=(0,a.Z)(c,i,r,!1,null,"3763d2a8",null),d=u.exports}}]);
//# sourceMappingURL=911.b50d2f54.js.map